#PARSER PQL
#DEFINE STARTTS 10748401988186756
#DEFINE OUTPUT WORKSPACE*\TILB\Task1\
#DROPALLQUERIES
#QUERY

oneminute = TIMEWINDOW({size = 600000000000000, advance = 10000000000000}, soccergame)

streams_join = join(oneminute, System.interruptions)

improve_join = SELECT({predicate = 'timestamp >= start_interruption && timestamp <= end_interruption'}, streams_join)

map_parameters_for_computation = STATEMAP({expressions = ['sid', ['timestamp - __last_1.timestamp', 'time_diff'], 'interruption']}, improve_join)

no_interrupts = SELECT({predicate = 'interruption = false'}, map_parameters_for_computation)

///ball = ROUTE({predicates=[RelationalPredicate('sid = 4'), RelationalPredicate('sid = 8'), 
			///RelationalPredicate('sid = 10'), RelationalPredicate('sid = 12')]}, no_interrupts)

///#LOOP i 0 UPTO 4			
     
	///agg${i} = AGGREGATE({aggregations=[['SUM', 'time_diff', 'COUNT_time', 'timestamp']]}, ${i}:ball)

///#ENDLOOP

result = AGGREGATE({group_by = ['sid'], aggregations=[['SUM', 'time_diff', 'COUNT_time', 'timestamp']]}, no_interrupts)
